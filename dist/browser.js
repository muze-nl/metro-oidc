(()=>{var C="https://metro.muze.nl/details/",m={isProxy:Symbol("isProxy"),source:Symbol("source")},ee=class e{#e={url:typeof window<"u"?window.location:"https://localhost"};#t=["get","post","put","delete","patch","head","options","query"];static tracers={};constructor(...o){for(let r of o)if(typeof r=="string"||r instanceof String)this.#e.url=""+r;else if(r instanceof e)Object.assign(this.#e,r.#e);else if(r instanceof Function)this.#r([r]);else if(r&&typeof r=="object")for(let t in r)t=="middlewares"?this.#r(r[t]):typeof r[t]=="function"?this.#e[t]=r[t](this.#e[t],this.#e):this.#e[t]=r[t];this.#e.verbs&&(this.#t=this.#e.verbs,delete this.#e.verbs);for(let r of this.#t)this[r]=async function(...t){return this.fetch(re(this.#e,...t,{method:r.toUpperCase()}))};Object.freeze(this)}#r(o){typeof o=="function"&&(o=[o]);let r=o.findIndex(t=>typeof t!="function");if(r>=0)throw S("metro.client: middlewares must be a function or an array of functions "+C+"client/invalid-middlewares-value/",o[r]);Array.isArray(this.#e.middlewares)||(this.#e.middlewares=[]),this.#e.middlewares=this.#e.middlewares.concat(o)}fetch(o,r){if(o=re(o,r),!o.url)throw S("metro.client."+o.method.toLowerCase()+": Missing url parameter "+C+"client/missing-url-param/",o);if(r||(r={}),typeof r!="object"||Array.isArray(r)||r instanceof String)throw S("metro.client.fetch: Options is not an object");let n=[async function(u){u[m.isProxy]&&(u=u[m.source]);let g=await fetch(u);return le(g)}].concat(this.#e?.middlewares?.slice()||[]);r=Object.assign({},this.#e,r);let i;for(let c of n)i=function(u,g){return async function(O){let j,A=Object.values(e.tracers);for(let s of A)s.request&&s.request.call(s,O,g);j=await g(O,u);for(let s of A)s.response&&s.response.call(s,j,g);return j}}(i,c);return i(o)}with(...o){return new e(this,...o)}};function P(...e){return new ee(...e)}function te(e,o){let r=o.body;return r||(e===null?r=new ReadableStream:e instanceof ReadableStream?r=e:e instanceof Blob?r=e.stream():r=new ReadableStream({start(t){let n;switch(typeof e){case"object":if(typeof e.toString=="function")n=e.toString();else if(e instanceof FormData)n=new URLSearchParams(e).toString();else if(e instanceof ArrayBuffer||ArrayBuffer.isView(e))n=e;else throw S("Cannot convert body to ReadableStream",e);break;case"string":case"number":case"boolean":n=e;break;default:throw S("Cannot convert body to ReadableStream",e)}t.enqueue(n),t.close()}})),new Proxy(r,{get(t,n,i){switch(n){case m.isProxy:return!0;case m.source:return e;case"toString":return function(){return""+e}}if(e&&typeof e=="object"&&n in e)return typeof e[n]=="function"?function(...c){return e[n].apply(e,c)}:e[n];if(n in t&&n!="toString")return typeof t[n]=="function"?function(...c){return t[n].apply(t,c)}:t[n]},has(t,n){return e&&typeof e=="object"?n in e:n in t},ownKeys(t){return Reflect.ownKeys(e&&typeof e=="object"?e:t)},getOwnPropertyDescriptor(t,n){return Object.getOwnPropertyDescriptor(e&&typeof e=="object"?e:t,n)}})}function we(e,o){let r=o||{};!r.url&&o.url&&(r.url=o.url);for(let t of["method","headers","body","mode","credentials","cache","redirect","referrer","referrerPolicy","integrity","keepalive","signal","priority","url"])if(typeof e[t]=="function")e[t](r[t],r);else if(typeof e[t]<"u")if(t=="url")r.url=H(r.url,e.url);else if(t=="headers"){r.headers=new Headers(o.headers),e.headers instanceof Headers||(e.headers=new Headers(e.headers));for(let[n,i]of e.headers.entries())r.headers.set(n,i)}else r[t]=e[t];return r}function re(...e){let o={url:typeof window<"u"?window.location:"https://localhost/",duplex:"half"};for(let n of e)typeof n=="string"||n instanceof URL||n instanceof URLSearchParams?o.url=H(o.url,n):n&&(n instanceof FormData||n instanceof ReadableStream||n instanceof Blob||n instanceof ArrayBuffer||n instanceof DataView)?o.body=n:n&&typeof n=="object"&&Object.assign(o,we(n,o));let r=o.body;r&&typeof r=="object"&&!(r instanceof String)&&!(r instanceof ReadableStream)&&!(r instanceof Blob)&&!(r instanceof ArrayBuffer)&&!(r instanceof DataView)&&!(r instanceof FormData)&&!(r instanceof URLSearchParams)&&(typeof TypedArray>"u"||!(r instanceof TypedArray))&&(o.body=JSON.stringify(r));let t=new Request(o.url,o);return Object.freeze(t),new Proxy(t,{get(n,i,c){switch(i){case m.source:return n;case m.isProxy:return!0;case"with":return function(...u){return r&&u.unshift({body:r}),re(n,...u)};case"toString":case"toJSON":return function(){return n[i].apply(n)};case"blob":case"text":case"json":return function(){return n[i].apply(n)};case"body":if(r||(r=n.body),r)return r[m.isProxy]?r:te(r,n);break}return n[i]}})}function fe(e,o){let r=o||{};!r.url&&o.url&&(r.url=o.url);for(let t of["status","statusText","headers","body","url","type","redirected"])typeof e[t]=="function"?e[t](r[t],r):typeof e[t]<"u"&&(t=="url"?r.url=new URL(e.url,r.url||"https://localhost/"):r[t]=e[t]);return r}function le(...e){let o={};for(let t of e)typeof t=="string"?o.body=t:t instanceof Response?Object.assign(o,fe(t,o)):t&&typeof t=="object"&&(t instanceof FormData||t instanceof Blob||t instanceof ArrayBuffer||t instanceof DataView||t instanceof ReadableStream||t instanceof URLSearchParams||t instanceof String||typeof TypedArray<"u"&&t instanceof TypedArray?o.body=t:Object.assign(o,fe(t,o)));let r=new Response(o.body,o);return Object.freeze(r),new Proxy(r,{get(t,n,i){switch(n){case m.isProxy:return!0;case m.source:return t;case"with":return function(...c){return le(t,...c)};case"body":return o.body?o.body[m.isProxy]?o.body:te(o.body,t):te("",t);case"ok":return t.status>=200&&t.status<400;case"headers":return t.headers;default:if(n in o&&n!="toString")return o[n];if(n in t&&n!="toString")return typeof t[n]=="function"?function(...c){return t[n].apply(t,c)}:t[n];break}}})}function ue(e,o){typeof o=="function"?o(e.searchParams,e):(o=new URLSearchParams(o),o.forEach((r,t)=>{e.searchParams.append(t,r)}))}function H(...e){let o=["hash","host","hostname","href","password","pathname","port","protocol","username","search","searchParams"],r=new URL("https://localhost/");for(let t of e)if(typeof t=="string"||t instanceof String)r=new URL(t,r);else if(t instanceof URL||typeof Location<"u"&&t instanceof Location)r=new URL(t);else if(t instanceof URLSearchParams)ue(r,t);else if(t&&typeof t=="object")for(let n in t)if(n=="search")typeof t.search=="function"?t.search(r.search,r):r.search=new URLSearchParams(t.search);else if(n=="searchParams")ue(r,t.searchParams);else{if(!o.includes(n))throw S("metro.url: unknown url parameter "+C+"url/unknown-param-name/",n);if(typeof t[n]=="function")t[n](r[n],r);else if(typeof t[n]=="string"||t[n]instanceof String||typeof t[n]=="number"||t[n]instanceof Number||typeof t[n]=="boolean"||t[n]instanceof Boolean)r[n]=""+t[n];else if(typeof t[n]=="object"&&t[n].toString)r[n]=t[n].toString();else throw S("metro.url: unsupported value for "+n+" "+C+"url/unsupported-param-value/",e[n])}else throw S("metro.url: unsupported option value "+C+"url/unsupported-option-value/",t);return Object.freeze(r),new Proxy(r,{get(t,n,i){switch(n){case m.isProxy:return!0;case m.source:return t;case"with":return function(...c){return H(t,...c)};case"toString":case"toJSON":return function(){return t[n]()}}return t[n]}})}var ge={error:(e,...o)=>{console.error("\u24C2\uFE0F  ",e,...o)},info:(e,...o)=>{console.info("\u24C2\uFE0F  ",e,...o)},group:e=>{console.group("\u24C2\uFE0F  "+e)},groupEnd:e=>{console.groupEnd("\u24C2\uFE0F  "+e)}};function S(e,...o){return ge.error(e,...o),new Error(e,...o)}function M(e){return e=Object.assign({reviver:null,replacer:null,space:""},e),async(o,r)=>{["POST","PUT","PATCH","QUERY"].includes(o.method)?(o=o.with({headers:{"Content-Type":"application/json",Accept:"application/json"}}),o.body&&typeof o.body[m.source]=="object"&&(o=o.with({body:JSON.stringify(o.body[m.source],e.replacer,e.space)}))):o=o.with({headers:{Accept:"application/json"}});let t=await r(o),n=await t.text(),i=JSON.parse(n,e.reviver);return t.with({body:i})}}function I(e){return async(o,r)=>{let t=await r(o);if(!t.ok)if(e&&typeof e[t.status]=="function")t=e[t.status].apply(t,o);else throw new Error(t.status+": "+t.statusText,{cause:t});return t}}globalThis.assertEnabled=!1;function E(e,o){if(globalThis.assertEnabled){let r=x(e,o);if(r)throw console.error("\u{1F170}\uFE0F  Assertions failed because of:",r,"in this source:",e),new Error("Assertions failed",{cause:{problems:r,source:e}})}}function a(e){return function(r,t,n){if(typeof r<"u"&&r!=null&&typeof e<"u")return x(r,e,t,n)}}function y(e){return function(r,t,n){return r==null||typeof r>"u"?d("data is required",r,e||"any value",n):typeof e<"u"?x(r,e,t,n):!1}}function N(e){return function(r,t,n){return r==null||typeof r>"u"?(console.warn("data does not contain recommended value",r,e,n),!1):x(r,e,t,n)}}function b(...e){return function(r,t,n){for(let i of e)if(!x(r,i,t,n))return!1;return d("data does not match oneOf patterns",r,e,n)}}function T(...e){return function(r,t,n){if(!Array.isArray(r))return d("data is not an array",r,"anyOf",n);for(let i of r)if(b(...e)(i))return d("data does not match anyOf patterns",i,e,n);return!1}}function de(...e){return function(r,t,n){let i=[];for(let c of e)i=i.concat(x(r,c,t,n));if(i=i.filter(Boolean),i.length)return d("data does not match all given patterns",r,e,n,i)}}function h(e,o,r){try{e instanceof URL&&(e=e.href);let t=new URL(e);if(t.href!=e&&!(t.href+"/"==e||t.href==e+"/"))return d("data is not a valid url",e,"validURL",r)}catch{return d("data is not a valid url",e,"validURL",r)}}function he(e,o,r){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return d("data is not a valid email",e,"validEmail",r)}function X(e){return function(r,t,n){if(!(r instanceof e))return d("data is not an instanceof pattern",r,e,n)}}function V(e){return function(r,t,n){if(!x(r,e,t,n))return d("data matches pattern, when required not to",r,e,n)}}function x(e,o,r,t=""){r||(r=e);let n=[];if(o===Boolean)typeof e!="boolean"&&!(e instanceof Boolean)&&n.push(d("data is not a boolean",e,o,t));else if(o===Number)typeof e!="number"&&!(e instanceof Number)&&n.push(d("data is not a number",e,o,t));else if(o===String)typeof e!="string"&&!(e instanceof String)&&n.push(d("data is not a string",e,o,t)),e==""&&n.push(d("data is an empty string, which is not allowed",e,o,t));else if(o instanceof RegExp)if(Array.isArray(e)){let i=e.findIndex((c,u)=>x(c,o,r,t+"["+u+"]"));i>-1&&n.push(d("data["+i+"] does not match pattern",e[i],o,t+"["+i+"]"))}else typeof e>"u"?n.push(d("data is undefined, should match pattern",e,o,t)):o.test(e)||n.push(d("data does not match pattern",e,o,t));else if(o instanceof Function){let i=o(e,r,t);i&&(Array.isArray(i)?n=n.concat(i):n.push(i))}else if(Array.isArray(o)){Array.isArray(e)||n.push(d("data is not an array",e,[],t));for(let i of o)for(let c of e.keys()){let u=x(e[c],i,r,t+"["+c+"]");Array.isArray(u)?n=n.concat(u):u&&n.push(u)}}else if(o&&typeof o=="object")if(Array.isArray(e)){let i=e.findIndex((c,u)=>x(c,o,r,t+"["+u+"]"));i>-1&&n.push(d("data["+i+"] does not match pattern",e[i],o,t+"["+i+"]"))}else if(!e||typeof e!="object")n.push(d("data is not an object, pattern is",e,o,t));else if(e instanceof URLSearchParams&&(e=Object.fromEntries(e)),o instanceof Function){let i=x(e,o,r,t);i&&(n=n.concat(i))}else for(let[i,c]of Object.entries(o)){let u=x(e[i],c,r,t+"."+i);u&&(n=n.concat(u))}else o!=e&&n.push(d("data and pattern are not equal",e,o,t));return n.length?n:!1}function d(e,o,r,t,n){let i={message:e,found:o,expected:r,path:t};return n&&(i.problems=n),i}var J=(...e)=>(o,r)=>e.filter(t=>r.hasOwnKey(t)).length>0?!1:d("root data must have all of",r,e),U=(...e)=>o=>Array.isArray(o)&&e.filter(r=>!o.includes(r)).length==0?!1:d("data must be an array which includes",data,e);var R=["HS256","HS384","HS512","RS256","RS384","RS512","ES256","ES384","ES512"],Z=["client_secret_post","client_secret_basic","client_secret_jwt","private_key_jwt"];async function K(e={}){E(e,{client:a(X(P().constructor)),issuer:y(h)});let o={client:P().with(I()).with(M()),requireDynamicRegistration:!1};e=Object.assign({},o,e);let r=!1;function t(u){return r}let n={issuer:y(de(e.issuer,t)),authorization_endpoint:y(h),token_endpoint:y(h),userinfo_endpoint:N(h),jwks_uri:y(h),registration_endpoint:e.requireDynamicRegistration?y(h):N(h),scopes_supported:N(U("openid")),response_types_supported:e.requireDynamicRegistration?y(U("code","id_token","id_token token")):y([]),response_modes_supported:a([]),grant_types_supported:e.requireDynamicRegistration?a(U("authorization_code")):a([]),acr_values_supported:a([]),subject_types_supported:y([]),id_token_signing_alg_values_supported:y(U("RS256")),id_token_encryption_alg_values_supported:a([]),id_token_encryption_enc_values_supported:a([]),userinfo_signing_alg_values_supported:a([]),userinfo_encryption_alg_values_supported:a([]),userinfo_encryption_enc_values_supported:a([]),request_object_signing_alg_values_supported:a(U("RS256")),request_object_encryption_alg_values_supported:a([]),request_object_encryption_enc_values_supported:a([]),token_endpoint_auth_methods_supported:a(T(...Z)),token_endpoint_auth_signing_alg_values_supported:a(U("RS256"),V(U("none"))),display_values_supported:a(T("page","popup","touch","wap")),claim_types_supported:a(T("normal","aggregated","distributed")),claims_supported:N([]),service_documentation:a(h),claims_locales_supported:a([]),ui_locales_supported:a([]),claims_parameter_supported:a(Boolean),request_parameter_supported:a(Boolean),request_uri_parameter_supported:a(Boolean),op_policy_uri:a(h),op_tos_uri:a(h)},c=(await e.client.get(H(e.issuer,".well-known/openid-configuration"))).body;return E(c,n),E(c.issuer,e.issuer),c}async function W(e){let o={redirect_uris:y([h]),response_types:a([]),grant_types:a(T("authorization_code","refresh_token")),application_type:a(b("native","web")),contacts:a([he]),client_name:a(String),logo_uri:a(h),client_uri:a(h),policy_uri:a(h),tos_uri:a(h),jwks_uri:a(h,V(J("jwks"))),jwks:a(h,V(J("jwks_uri"))),sector_identifier_uri:a(h),subject_type:a(String),id_token_signed_response_alg:a(b(...R)),id_token_encrypted_response_alg:a(b(...R)),id_token_encrypted_response_enc:a(b(...R),J("id_token_encrypted_response_alg")),userinfo_signed_response_alg:a(b(...R)),userinfo_encrypted_response_alg:a(b(...R)),userinfo_encrypted_response_enc:a(b(...R),J("userinfo_encrypted_response_alg")),request_object_signing_alg:a(b(...R)),request_object_encryption_alg:a(b(...R)),request_object_encryption_enc:a(b(...R)),token_endpoint_auth_method:a(b(...Z)),token_endpoint_auth_signing_alg:a(b(...R)),default_max_age:a(Number),require_auth_time:a(Boolean),default_acr_values:a([String]),initiate_login_uri:a([h]),request_uris:a([h])};E(e,{client:a(X(P().constructor)),registration_endpoint:h,client_info:o});let r={client:P().with(I()).with(M())};e=Object.assign({},r,e);let t=await e.client.post(e.registration_endpoint,{body:e.client_info}),n=t.body;if(!n.client_id||!n.client_secret)throw S("metro.oidc: Error: dynamic registration of client failed, no client_id or client_secret returned",t);return e.client_info=Object.assign(e.client_info,n),e.client_info}var $="https://metro.muze.nl/details/",w={isProxy:Symbol("isProxy"),source:Symbol("source")},ne=class e{#e={url:typeof window<"u"?window.location:"https://localhost"};#t=["get","post","put","delete","patch","head","options","query"];static tracers={};constructor(...o){for(let r of o)if(typeof r=="string"||r instanceof String)this.#e.url=""+r;else if(r instanceof e)Object.assign(this.#e,r.#e);else if(r instanceof Function)this.#r([r]);else if(r&&typeof r=="object")for(let t in r)t=="middlewares"?this.#r(r[t]):typeof r[t]=="function"?this.#e[t]=r[t](this.#e[t],this.#e):this.#e[t]=r[t];this.#e.verbs&&(this.#t=this.#e.verbs,delete this.#e.verbs);for(let r of this.#t)this[r]=async function(...t){return this.fetch(D(this.#e,...t,{method:r.toUpperCase()}))};Object.freeze(this)}#r(o){typeof o=="function"&&(o=[o]);let r=o.findIndex(t=>typeof t!="function");if(r>=0)throw _("metro.client: middlewares must be a function or an array of functions "+$+"client/invalid-middlewares-value/",o[r]);Array.isArray(this.#e.middlewares)||(this.#e.middlewares=[]),this.#e.middlewares=this.#e.middlewares.concat(o)}fetch(o,r){if(o=D(o,r),!o.url)throw _("metro.client."+o.method.toLowerCase()+": Missing url parameter "+$+"client/missing-url-param/",o);if(r||(r={}),typeof r!="object"||Array.isArray(r)||r instanceof String)throw _("metro.client.fetch: Options is not an object");let n=[async function(u){u[w.isProxy]&&(u=u[w.source]);let g=await fetch(u);return B(g)}].concat(this.#e?.middlewares?.slice()||[]);r=Object.assign({},this.#e,r);let i;for(let c of n)i=function(u,g){return async function(O){let j,A=Object.values(e.tracers);for(let s of A)s.request&&s.request.call(s,O,g);j=await g(O,u);for(let s of A)s.response&&s.response.call(s,j,g);return j}}(i,c);return i(o)}with(...o){return new e(this,...o)}};function ye(...e){return new ne(...e)}function oe(e,o){let r=o.body;return r||(e===null?r=new ReadableStream:e instanceof ReadableStream?r=e:e instanceof Blob?r=e.stream():r=new ReadableStream({start(t){let n;switch(typeof e){case"object":if(typeof e.toString=="function")n=e.toString();else if(e instanceof FormData)n=new URLSearchParams(e).toString();else if(e instanceof ArrayBuffer||ArrayBuffer.isView(e))n=e;else throw _("Cannot convert body to ReadableStream",e);break;case"string":case"number":case"boolean":n=e;break;default:throw _("Cannot convert body to ReadableStream",e)}t.enqueue(n),t.close()}})),new Proxy(r,{get(t,n,i){switch(n){case w.isProxy:return!0;case w.source:return e;case"toString":return function(){return""+e}}if(typeof e=="object"&&n in e)return typeof e[n]=="function"?function(...c){return e[n].apply(e,c)}:e[n];if(n in t&&n!="toString")return typeof t[n]=="function"?function(...c){return t[n].apply(t,c)}:t[n]},has(t,n){return n in e},ownKeys(t){return Reflect.ownKeys(typeof e=="object"?e:t)},getOwnPropertyDescriptor(t,n){return Object.getOwnPropertyDescriptor(e,n)}})}function ke(e,o){let r=o||{};!r.url&&o.url&&(r.url=o.url);for(let t of["method","headers","body","mode","credentials","cache","redirect","referrer","referrerPolicy","integrity","keepalive","signal","priority","url"])if(typeof e[t]=="function")e[t](r[t],r);else if(typeof e[t]<"u")if(t=="url")r.url=L(r.url,e.url);else if(t=="headers"){r.headers=new Headers(o.headers),e.headers instanceof Headers||(e.headers=new Headers(e.headers));for(let[n,i]of e.headers.entries())r.headers.set(n,i)}else r[t]=e[t];return r}function D(...e){let o={url:typeof window<"u"?window.location:"https://localhost/",duplex:"half"};for(let n of e)typeof n=="string"||n instanceof URL||n instanceof URLSearchParams?o.url=L(o.url,n):n&&(n instanceof FormData||n instanceof ReadableStream||n instanceof Blob||n instanceof ArrayBuffer||n instanceof DataView)?o.body=n:n&&typeof n=="object"&&Object.assign(o,ke(n,o));let r=o.body;r&&typeof r=="object"&&!(r instanceof String)&&!(r instanceof ReadableStream)&&!(r instanceof Blob)&&!(r instanceof ArrayBuffer)&&!(r instanceof DataView)&&!(r instanceof FormData)&&!(r instanceof URLSearchParams)&&(typeof TypedArray>"u"||!(r instanceof TypedArray))&&(o.body=JSON.stringify(r));let t=new Request(o.url,o);return Object.freeze(t),new Proxy(t,{get(n,i,c){switch(i){case w.source:return n;case w.isProxy:return!0;case"with":return function(...u){return r&&u.unshift({body:r}),D(n,...u)};case"toString":case"toJSON":return function(){return n[i].apply(n)};case"blob":case"text":case"json":return function(){return n[i].apply(n)};case"body":if(r||(r=n.body),r)return r[w.isProxy]?r:oe(r,n);break}return n[i]}})}function pe(e,o){let r=o||{};!r.url&&o.url&&(r.url=o.url);for(let t of["status","statusText","headers","body","url","type","redirected"])typeof e[t]=="function"?e[t](r[t],r):typeof e[t]<"u"&&(t=="url"?r.url=new URL(e.url,r.url||"https://localhost/"):r[t]=e[t]);return r}function B(...e){let o={};for(let t of e)typeof t=="string"?o.body=t:t instanceof Response?Object.assign(o,pe(t,o)):t&&typeof t=="object"&&(t instanceof FormData||t instanceof Blob||t instanceof ArrayBuffer||t instanceof DataView||t instanceof ReadableStream||t instanceof URLSearchParams||t instanceof String||typeof TypedArray<"u"&&t instanceof TypedArray?o.body=t:Object.assign(o,pe(t,o)));let r=new Response(o.body,o);return Object.freeze(r),new Proxy(r,{get(t,n,i){switch(n){case w.isProxy:return!0;case w.source:return t;case"with":return function(...c){return B(t,...c)};case"body":return o.body?o.body[w.isProxy]?o.body:oe(o.body,t):oe("",t);case"ok":return t.status>=200&&t.status<400;case"headers":return t.headers;default:if(n in o&&n!="toString")return o[n];if(n in t&&n!="toString")return typeof t[n]=="function"?function(...c){return t[n].apply(t,c)}:t[n];break}}})}function me(e,o){typeof o=="function"?o(e.searchParams,e):(o=new URLSearchParams(o),o.forEach((r,t)=>{e.searchParams.append(t,r)}))}function L(...e){let o=["hash","host","hostname","href","password","pathname","port","protocol","username","search","searchParams"],r=new URL("https://localhost/");for(let t of e)if(typeof t=="string"||t instanceof String)r=new URL(t,r);else if(t instanceof URL||typeof Location<"u"&&t instanceof Location)r=new URL(t);else if(t instanceof URLSearchParams)me(r,t);else if(t&&typeof t=="object")for(let n in t)if(n=="search")typeof t.search=="function"?t.search(r.search,r):r.search=new URLSearchParams(t.search);else if(n=="searchParams")me(r,t.searchParams);else{if(!o.includes(n))throw _("metro.url: unknown url parameter "+$+"url/unknown-param-name/",n);if(typeof t[n]=="function")t[n](r[n],r);else if(typeof t[n]=="string"||t[n]instanceof String||typeof t[n]=="number"||t[n]instanceof Number||typeof t[n]=="boolean"||t[n]instanceof Boolean)r[n]=""+t[n];else if(typeof t[n]=="object"&&t[n].toString)r[n]=t[n].toString();else throw _("metro.url: unsupported value for "+n+" "+$+"url/unsupported-param-value/",e[n])}else throw _("metro.url: unsupported option value "+$+"url/unsupported-option-value/",t);return Object.freeze(r),new Proxy(r,{get(t,n,i){switch(n){case w.isProxy:return!0;case w.source:return t;case"with":return function(...c){return L(t,...c)};case"toString":case"toJSON":return function(){return t[n]()}}return t[n]}})}function ie(...e){var o=new FormData;for(let r of e)if(r instanceof FormData)for(let t of r.entries())o.append(t[0],t[1]);else if(r&&typeof r=="object")for(let t of Object.entries(r))if(Array.isArray(t[1]))for(let n of t[1])o.append(t[0],n);else o.append(t[0],t[1]);else throw new _("metro.formdata: unknown option type, only FormData or Object supported",r);return Object.freeze(o),new Proxy(o,{get:(r,t,n)=>{switch(t){case w.isProxy:return!0;case w.source:return r;case"with":return function(...i){return ie(r,...i)}}return r[t]}})}var Se={error:(e,...o)=>{console.error("\u24C2\uFE0F  ",e,...o)},info:(e,...o)=>{console.info("\u24C2\uFE0F  ",e,...o)},group:e=>{console.group("\u24C2\uFE0F  "+e)},groupEnd:e=>{console.groupEnd("\u24C2\uFE0F  "+e)}};function _(e,...o){return Se.error(e,...o),new Error(e,...o)}globalThis.assertEnabled=!1;var Q=(e,o)=>{if(globalThis.assertEnabled){let r=F(e,o);if(r)throw new se("Assertions failed",r,e)}};var Y=e=>o=>F(o,e);function _e(e){try{if(e instanceof URL&&(e=e.href),new URL(e).href!=e)return v("data is not a valid url",e,"validURL")}catch{return v("data is not a valid url",e,"validURL")}return!1}function F(e,o,r){r||(r=e);let t=[];if(o===Boolean)typeof e!="boolean"&&t.push(v("data is not a boolean",e,o));else if(o===Number)typeof e!="number"&&t.push(v("data is not a number",e,o));else if(o instanceof RegExp)if(Array.isArray(e)){let n=e.findIndex(i=>F(i,o,r));n>-1&&t.push(v("data["+n+"] does not match pattern",e[n],o))}else o.test(e)||t.push(v("data does not match pattern",e,o));else if(o instanceof Function)o(e,r)&&t.push(v("data does not match function",e,o));else if(Array.isArray(o)){Array.isArray(e)||t.push(v("data is not an array",e,[]));for(p of o){let n=F(e,p,r);Array.isArray(n)?t.concat(n):n&&t.push(n)}}else if(o&&typeof o=="object")if(Array.isArray(e)){let n=e.findIndex(i=>F(i,o,r));n>-1&&t.push(v("data["+n+"] does not match pattern",e[n],o))}else if(!e||typeof e!="object")t.push(v("data is not an object, pattern is",e,o));else{e instanceof URLSearchParams&&(e=Object.fromEntries(e));let n=t[t.length-1];for(let[i,c]of Object.entries(o)){let u=F(e[i],c,r);u&&((!n||typeof n=="string")&&(n={},t.push(v(n,e[i],c))),n[i]=u.problems)}}else o!=e&&t.push(v("data and pattern are not equal",e,o));return t.length?t:!1}var se=class extends Error{constructor(o,r,...t){super(o),this.problems=r,this.details=t}};function v(e,o,r){return{message:e,found:o,expected:r}}function be(e){let o,r;if(typeof localStorage<"u")o={get:()=>localStorage.getItem("metro/state:"+e),set:t=>localStorage.setItem("metro/state:"+e,t),has:()=>localStorage.getItem("metro/state:"+e)!==null},r={get:t=>localStorage.getItem(e+":"+t),set:(t,n)=>localStorage.setItem(e+":"+t,n),has:t=>localStorage.getItem(e+":"+t)!==null};else{let t=new Map;o={get:()=>t.get("metro/state:"+e),set:n=>t.set("metro/state:"+e,n),has:()=>t.has("metro/state:"+e)},r=new Map}return{state:o,tokens:r}}function ae(e){let o={client:ye(),force_authorization:!1,site:"default",oauth2_configuration:{authorization_endpoint:"/authorize",token_endpoint:"/token",redirect_uri:globalThis.document?.location.href,grant_type:"authorization_code",code_verifier:q.generateCodeVerifier(64)},callbacks:{authorize:s=>document.location=s}};Q(e,{});let r=Object.assign({},o.oauth2_configuration,e?.oauth2_configuration);e=Object.assign({},o,e),e.oauth2_configuration=r;let t=be(e.site);e.tokens||(e.tokens=t.tokens),e.state||(e.state=t.state),Q(e,{oauth2_configuration:{client_id:Y(),grant_type:"authorization_code",authorization_endpoint:Y(),token_endpoint:Y(),redirect_uri:Y(_e)}});for(let s in r)switch(s){case"access_token":case"authorization_code":case"refresh_token":e.tokens.set(s,r[s]);break}return async function(s,l){if(e.force_authorization)return n(s,l);let f;try{if(f=await l(s),f.ok)return f}catch(k){switch(f.status){case 400:case 401:return n(s,l)}throw k}return f};async function n(s,l){if(i(),e.tokens.has("access_token")){if(j(s))return await u()?n(s,l):B("false");{let f=e.tokens.get("access_token");return s=D(s,{headers:{Authorization:f.type+" "+f.value}}),l(s)}}else{try{if(!await c())return B("false")}catch(f){throw console.log("caught",f),f}return n(s,l)}}function i(){if(typeof window<"u"&&window?.location){let s=L(window.location),l,f,k;if(s.searchParams.has("code"))k=s.searchParams,s=s.with({search:""}),history.pushState({},"",s.href);else if(s.hash){let z=s.hash.substr(1);k=new URLSearchParams("?"+z),s=s.with({hash:""}),history.pushState({},"",s.href)}if(k){l=k.get("code"),f=k.get("state");let z=e.state.get("metro/state");if(!f||f!==z)return;l&&e.tokens.set("authorization_code",l)}}}async function c(){if(r.grant_type==="authorization_code"&&!e.tokens.has("authorization_code")){let k=g();if(!e.callbacks.authorize||typeof e.callbacks.authorize!="function")throw _("oauth2mw: oauth2 with grant_type:authorization_code requires a callback function in client options.options.callbacks.authorize");let z=await e.callbacks.authorize(k);if(z)e.tokens.set("authorization_code",z);else return B(!1)}let s=O(),l=await e.client.post(s);if(!l.ok)throw _("OAuth2mw: fetch access_token: "+l.status+": "+l.statusText,{cause:s});let f=await l.json();if(e.tokens.set("access_token",{value:f.access_token,expires:A(f.expires_in),type:f.token_type,scope:f.scope}),f.refresh_token){let k={value:f.refresh_token};e.tokens.set("refresh_token",k)}return f}async function u(){let s=O("refresh_token"),l=await e.client.post(s);if(!l.ok)throw _("OAuth2mw: refresh access_token: "+l.status+": "+l.statusText,{cause:s});let f=await l.json();if(e.tokens.set("access_token",{value:f.access_token,expires:A(f.expires_in),type:f.token_type,scope:f.scope}),f.refresh_token){let k={value:f.refresh_token};e.tokens.set("refresh_token",k)}return f}function g(){if(!r.authorize_endpoint)throw _("oauth2mw: Missing options.endpoints.authorize url");let s=L(r.authorize_endpoint,{hash:""});Q(r,{client_id:/.+/,redirect_uri:/.+/,scope:/.*/});let l={response_type:"code",client_id:r.client_id,client_secret:r.client_secret,redirect_uri:r.redirect_uri,state:r.state||q.createState(40)};return e.state.set(l.state),r.code_verifier&&(delete l.client_secret,l.code_challenge=q.generateCodeChallenge(r.code_verifier),l.code_challenge_method="S256"),r.scope&&(l.scope=r.scope),L(s,{search:l})}function O(s=null){if(Q(r,{client_id:/.+/,redirect_uri:/.+/}),!r.token_endpoint)throw _("oauth2mw: Missing options.endpoints.token url");let l=L(r.token_endpoint,{hash:""}),f={grant_type:s||r.grant_type,client_id:r.client_id};switch(r.code_verifier?f.code_verifier=r.code_verifier:f.client_secret=r.client_secret,r.scope&&(f.scope=r.scope),r.grant_type){case"authorization_code":f.redirect_uri=r.redirect_uri,f.code=e.tokens.get("authorization_code");break;case"client_credentials":break;case"refresh_token":f.refresh_token=r.refresh_token;break;default:throw new Error("Unknown grant_type: ".oauth2.grant_type)}return D(l,{method:"POST"},ie(f))}function j(s){if(s.oauth2&&s.options.tokens&&s.options.tokens.has("access_token")){let l=new Date,f=s.options.tokens.get("access_token");return l.getTime()>f.expires.getTime()}return!1}function A(s){if(s instanceof Date)return new Date(s.getTime());if(typeof s=="number"){let l=new Date;return l.setSeconds(l.getSeconds()+s),l}throw new TypeError("Unknown expires type "+s)}}var q={generateCodeVerifier:function(e=64){let o=new Uint8Array(e);return globalThis.crypto.getRandomValues(o),o.toString("hex")},generateCodeChallenge:async function(e){let o=q.base64url_encode(e),t=new TextEncoder().encode(o);return await globalThis.crypto.subtle.digest("SHA-256",t)},base64url_encode:function(e){let o=Array.from(new Uint8Array(e),r=>String.fromCharCode(r)).join("");return btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")},createState:function(e){let o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",t=0;for(;t<e;)r+=o.charAt(Math.floor(Math.random()*o.length)),t++;return r}};function ce(e={}){let o={client:P(),force_authorization:!1};return e=Object.assign({},o,e),async(r,t)=>{let n;if(!e.force_authorization){try{n=await t(r)}catch(u){if(n.status!=401&&n.status!=403)throw u}if(n.ok||n.status!=401&&n.status!=403)return n}if(e.openid_configuration||(e.openid_configuration=await K({issuer:e.issuer})),!e.client_info?.client_id){if(E(e.client_info?.client_name,y()),!e.openid_configuration.registration_endpoint)throw S("metro.oidcmw: Error: issuer "+e.issuer+" does not support dynamic client registration, but you haven't specified a client_id");e.client_info=await W({registration_endpoint:e.openid_configuration.registration_endpoint,client_info:e.client_info})}let i=Object.assign({site:e.issuer,client:e.client,force_authorization:!0,oauth2_configuration:{client_id:e.client_info.client_id,client_secret:e.client_info.client_secret,grant_type:"authorization_code",authorization_endpoint:e.openid_configuration.authorization_endpoint,token_endpoint:e.openid_configuration.token_endpoint}});return n=await e.client.with(e.issuer).with(ae(i)).fetch(r),n}}var ve={discover:K,register:W,oidcmw:ce};globalThis.oidc=ve;})();
//# sourceMappingURL=browser.js.map
